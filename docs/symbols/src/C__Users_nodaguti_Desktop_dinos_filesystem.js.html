<html><head><meta http-equiv='content-type' content='text/html; charset=utf-8'>
	<script type='text/javascript' >
	window.onload=function(){
	    var num = document.getElementById(location.hash.replace(/^#/,''));
	    if (num) {
	        num.style.color = 'RGB(255,255,50)';
	        num.style.backgroundColor = 'RGB(255,140,0)';
	    }
	}
	</script>
	<style>
	body, pre {font-family: 'MS Gothic',monospace; font-size: 12px; color:RGB(48,48,48); line-height: 14px; margin: 0px;}
	.KEYW {color: RGB(0,160,255); font-weight:bold;}
	.COMM {color: RGB(120,192,0)}
	.NUMB {color: RGB(128,99,0)}
	.STRN {color: RGB(220,160,60)}
	.REGX {color: RGB(230,0,0)}
	.line {border-right: 1px dotted RGB(140,140,140); color: RGB(140,140,140); background-color: RGB(240,240,240); padding: 1px 1px 1px 3px;}
	.doccmt {color: RGB(150,150,255)}
	.doctag {color: RGB(90,90,255)}
	.spacer {height:6px;overflow:hidden;}
	</style></head>
	<body lang='ja'><div class='spacer'><span class='line'>&nbsp;&nbsp;&nbsp;&nbsp;</span></div><pre><span id='line1' class='line'>   1</span> <span class="doccmt">/**
<span id='line2' class='line'>   2</span>  * Dinos File System
<span id='line3' class='line'>   3</span>  * <span class="doctag">@class</span>
<span id='line4' class='line'>   4</span>  */</span><span class="WHIT">
<span id='line5' class='line'>   5</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">joFileManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span id='line6' class='line'>   6</span> 
<span id='line7' class='line'>   7</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">fileTree</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span id='line8' class='line'>   8</span> 
<span id='line9' class='line'>   9</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line10' class='line'>  10</span> &nbsp;&nbsp;&nbsp;&nbsp; * 起動時に一度だけ実行される
<span id='line11' class='line'>  11</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@private</span>
<span id='line12' class='line'>  12</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line13' class='line'>  13</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line14' class='line'>  14</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deferred</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Deferred</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line15' class='line'>  15</span> 
<span id='line16' class='line'>  16</span> </span><span class="COMM">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.storage = uu('Storage');</span><span class="WHIT">
<span id='line17' class='line'>  17</span> </span><span class="COMM">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(this.storage.toString() === 'MemStorage') this.storage = null;</span><span class="WHIT">
<span id='line18' class='line'>  18</span> 
<span id='line19' class='line'>  19</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.storage</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line20' class='line'>  20</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line21' class='line'>  21</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.fileTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.Node.textToDOM</span><span class="PUNC">(</span><span class="NAME">this.storage.get</span><span class="PUNC">(</span><span class="STRN">'fileTree'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line22' class='line'>  22</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line23' class='line'>  23</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span id='line24' class='line'>  24</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line25' class='line'>  25</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">joCore.IO.Network.read</span><span class="PUNC">(</span><span class="STRN">'disk.xml'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">next</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">req</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line26' class='line'>  26</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line27' class='line'>  27</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">req.responseXML</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line28' class='line'>  28</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line29' class='line'>  29</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//responseXMLがある時 - for Firefox, Safari</span><span class="WHIT">
<span id='line30' class='line'>  30</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joFileManager.fileTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">req.responseXML</span><span class="PUNC">;</span><span class="WHIT">
<span id='line31' class='line'>  31</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line32' class='line'>  32</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">req.responseText</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line33' class='line'>  33</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line34' class='line'>  34</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//responseTextはある時</span><span class="WHIT">
<span id='line35' class='line'>  35</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.Node.textToDOM</span><span class="PUNC">(</span><span class="NAME">req.responseText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line36' class='line'>  36</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">xml</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'[joFileManager] Cannot load disk.xml from responseText'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line37' class='line'>  37</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line38' class='line'>  38</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joFileManager.fileTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xml</span><span class="PUNC">;</span><span class="WHIT">
<span id='line39' class='line'>  39</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line40' class='line'>  40</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line41' class='line'>  41</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">error</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line42' class='line'>  42</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line43' class='line'>  43</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//Cross Domain Errorの時　- for Google Chrome, Opera</span><span class="WHIT">
<span id='line44' class='line'>  44</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">joCore.IO.Local.read</span><span class="PUNC">(</span><span class="STRN">'disk.xml'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'text/html'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">next</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line45' class='line'>  45</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line46' class='line'>  46</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joFileManager.fileTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.Node.textToDOM</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line47' class='line'>  47</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line48' class='line'>  48</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">error</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line49' class='line'>  49</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.logger.error</span><span class="PUNC">(</span><span class="STRN">'[joFileManager] Cannot load disk.xml'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line50' class='line'>  50</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line51' class='line'>  51</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line52' class='line'>  52</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line53' class='line'>  53</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line54' class='line'>  54</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line55' class='line'>  55</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line56' class='line'>  56</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line57' class='line'>  57</span> &nbsp;&nbsp;&nbsp;&nbsp; * 終了処理
<span id='line58' class='line'>  58</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@private</span>
<span id='line59' class='line'>  59</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line60' class='line'>  60</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">uninit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line61' class='line'>  61</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.Node.DOMToText</span><span class="PUNC">(</span><span class="NAME">joFileManager.fileTree</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line62' class='line'>  62</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.IO.Local.write</span><span class="PUNC">(</span><span class="NAME">treeText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'disk.xml'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line63' class='line'>  63</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line64' class='line'>  64</span> 
<span id='line65' class='line'>  65</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">onChangeTree</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line66' class='line'>  66</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//変更を通知</span><span class="WHIT">
<span id='line67' class='line'>  67</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joEvent.fireEvent</span><span class="PUNC">(</span><span class="STRN">'joFileChanged'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">window.document</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line68' class='line'>  68</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line69' class='line'>  69</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//this._saveFileTree();</span><span class="WHIT">
<span id='line70' class='line'>  70</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line71' class='line'>  71</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line72' class='line'>  72</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line73' class='line'>  73</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルツリーを保存する
<span id='line74' class='line'>  74</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line75' class='line'>  75</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_saveFileTree</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line76' class='line'>  76</span> </span><span class="COMM">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var treeText = joCore.Node.DOMToText(joFileManager.fileTree);</span><span class="WHIT">
<span id='line77' class='line'>  77</span> </span><span class="COMM">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location.href = 'data:application/octet-stream,' + encodeURIComponent(treeText);</span><span class="WHIT">
<span id='line78' class='line'>  78</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line79' class='line'>  79</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line80' class='line'>  80</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line81' class='line'>  81</span> &nbsp;&nbsp;&nbsp;&nbsp; * パスをCSSに変換する
<span id='line82' class='line'>  82</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line83' class='line'>  83</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line84' class='line'>  84</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {String} そのパスが指すフォルダを示すCSS&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line85' class='line'>  85</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line86' class='line'>  86</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_pathToCSS</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line87' class='line'>  87</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aPath.replace</span><span class="PUNC">(</span><span class="STRN">'dinos:/'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'root'</span><span class="PUNC">)</span><span class="WHIT">
<span id='line88' class='line'>  88</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\//g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'>'</span><span class="PUNC">)</span><span class="WHIT">
<span id='line89' class='line'>  89</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/>([^>]+)$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'>file[name="$1"]'</span><span class="PUNC">)</span><span class="WHIT">    </span><span class="COMM">//file name</span><span class="WHIT">
<span id='line90' class='line'>  90</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(.[^>]*)>/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'folder[name="$1"]>'</span><span class="PUNC">)</span><span class="WHIT">
<span id='line91' class='line'>  91</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/>$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line92' class='line'>  92</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line93' class='line'>  93</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line94' class='line'>  94</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line95' class='line'>  95</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルの名前を返す&lt;br>
<span id='line96' class='line'>  96</span> &nbsp;&nbsp;&nbsp;&nbsp; *   ファイルのパスを指定した場合： そのファイルの名前を返す&lt;br>
<span id='line97' class='line'>  97</span> &nbsp;&nbsp;&nbsp;&nbsp; *   フォルダのパスを指定した場合： 空文字を返す
<span id='line98' class='line'>  98</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line99' class='line'>  99</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line100' class='line'> 100</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {String} ファイルの名前
<span id='line101' class='line'> 101</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line102' class='line'> 102</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getFileNameFromPath</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line103' class='line'> 103</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aPath.match</span><span class="PUNC">(</span><span class="REGX">/([^\/]*)$/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line104' class='line'> 104</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line105' class='line'> 105</span> 
<span id='line106' class='line'> 106</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line107' class='line'> 107</span> &nbsp;&nbsp;&nbsp;&nbsp; * フォルダの名前を返す&lt;br>
<span id='line108' class='line'> 108</span> &nbsp;&nbsp;&nbsp;&nbsp; *   ファイルのパスを指定した場合： ファイルが入っているフォルダの名前を返す&lt;br>
<span id='line109' class='line'> 109</span> &nbsp;&nbsp;&nbsp;&nbsp; *   フォルダのパスを指定した場合： そのフォルダの名前を返す
<span id='line110' class='line'> 110</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line111' class='line'> 111</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line112' class='line'> 112</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {String} フォルダの名前
<span id='line113' class='line'> 113</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line114' class='line'> 114</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getFolderNameFromPath</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line115' class='line'> 115</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aPath.match</span><span class="PUNC">(</span><span class="REGX">/([^\/]*)\/[^\/]*$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'Dinos'</span><span class="PUNC">;</span><span class="WHIT">
<span id='line116' class='line'> 116</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line117' class='line'> 117</span> 
<span id='line118' class='line'> 118</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line119' class='line'> 119</span> &nbsp;&nbsp;&nbsp;&nbsp; * 親フォルダのパスを返す
<span id='line120' class='line'> 120</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line121' class='line'> 121</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line122' class='line'> 122</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {String/DinosPath} フォルダのパス
<span id='line123' class='line'> 123</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line124' class='line'> 124</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getParentFolderFromPath</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line125' class='line'> 125</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="REGX">/\/$/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line126' class='line'> 126</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//フォルダのとき</span><span class="WHIT">
<span id='line127' class='line'> 127</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aPath.replace</span><span class="PUNC">(</span><span class="REGX">/[^\/]*\/?$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line128' class='line'> 128</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span id='line129' class='line'> 129</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ファイルのとき</span><span class="WHIT">
<span id='line130' class='line'> 130</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath.replace</span><span class="PUNC">(</span><span class="REGX">/[^\/]+$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'dammy/'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line131' class='line'> 131</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line132' class='line'> 132</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line133' class='line'> 133</span> 
<span id='line134' class='line'> 134</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line135' class='line'> 135</span> &nbsp;&nbsp;&nbsp;&nbsp; * 親フォルダのパスツリーを返す
<span id='line136' class='line'> 136</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line137' class='line'> 137</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line138' class='line'> 138</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Array} 親フォルダのパス群が入った配列
<span id='line139' class='line'> 139</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line140' class='line'> 140</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getFolderTreeFromPath</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line141' class='line'> 141</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aPath.replace</span><span class="PUNC">(</span><span class="REGX">/[^\/]+$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line142' class='line'> 142</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line143' class='line'> 143</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getTree</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line144' class='line'> 144</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">returnArray.push</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line145' class='line'> 145</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joFileManager.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line146' class='line'> 146</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">getTree</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// dinos:// になったらやめる</span><span class="WHIT">
<span id='line147' class='line'> 147</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line148' class='line'> 148</span> 
<span id='line149' class='line'> 149</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getTree</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line150' class='line'> 150</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line151' class='line'> 151</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnArray</span><span class="PUNC">;</span><span class="WHIT">
<span id='line152' class='line'> 152</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line153' class='line'> 153</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line154' class='line'> 154</span> 
<span id='line155' class='line'> 155</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line156' class='line'> 156</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルを取得する
<span id='line157' class='line'> 157</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line158' class='line'> 158</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line159' class='line'> 159</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Node} ファイルのノード
<span id='line160' class='line'> 160</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line161' class='line'> 161</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getFile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line162' class='line'> 162</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._pathToCSS</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line163' class='line'> 163</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.logger.log</span><span class="PUNC">(</span><span class="STRN">'Get File:'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line164' class='line'> 164</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line165' class='line'> 165</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span id='line166' class='line'> 166</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line167' class='line'> 167</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span id='line168' class='line'> 168</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuQuery</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.fileTree</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line169' class='line'> 169</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line170' class='line'> 170</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//uuQuery error - IE?</span><span class="WHIT">
<span id='line171' class='line'> 171</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getNode</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line172' class='line'> 172</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line173' class='line'> 173</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line174' class='line'> 174</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.length</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span id='line175' class='line'> 175</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line176' class='line'> 176</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line177' class='line'> 177</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_getNode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line178' class='line'> 178</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path.split</span><span class="PUNC">(</span><span class="STRN">'>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line179' class='line'> 179</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fileTree</span><span class="PUNC">;</span><span class="WHIT">
<span id='line180' class='line'> 180</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line181' class='line'> 181</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">files.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line182' class='line'> 182</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'folder['</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span id='line183' class='line'> 183</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/name="([^"]+)"\]$/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line184' class='line'> 184</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line185' class='line'> 185</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">current.childNodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">m</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line186' class='line'> 186</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current.childNodes</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line187' class='line'> 187</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line188' class='line'> 188</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isFolder</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">file.tagName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'folder'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span id='line189' class='line'> 189</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isFolder</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">file.tagName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'file'</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line190' class='line'> 190</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line191' class='line'> 191</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">file.getAttribute</span><span class="PUNC">(</span><span class="STRN">'name'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line192' class='line'> 192</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">file</span><span class="PUNC">;</span><span class="WHIT">
<span id='line193' class='line'> 193</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span id='line194' class='line'> 194</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line195' class='line'> 195</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line196' class='line'> 196</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line197' class='line'> 197</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line198' class='line'> 198</span> 
<span id='line199' class='line'> 199</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">current</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line200' class='line'> 200</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line201' class='line'> 201</span> 
<span id='line202' class='line'> 202</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line203' class='line'> 203</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルを作成する&lt;br>
<span id='line204' class='line'> 204</span> &nbsp;&nbsp;&nbsp;&nbsp; * 指定した親フォルダがない場合は自動で作成する
<span id='line205' class='line'> 205</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line206' class='line'> 206</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String} aName 作成するファイルの名前
<span id='line207' class='line'> 207</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath 親フォルダのパス
<span id='line208' class='line'> 208</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {Object} [aAttrs] ファイルに付加する属性
<span id='line209' class='line'> 209</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Node} 作成されたファイルのノード
<span id='line210' class='line'> 210</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line211' class='line'> 211</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">createFile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aAttrs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line212' class='line'> 212</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line213' class='line'> 213</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createFolder</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line214' class='line'> 214</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line215' class='line'> 215</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aAttrs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line216' class='line'> 216</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">aAttrs.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aName</span><span class="PUNC">;</span><span class="WHIT">
<span id='line217' class='line'> 217</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">aAttrs.createdate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line218' class='line'> 218</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line219' class='line'> 219</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line220' class='line'> 220</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ファイルがすでに存在していたら上書きする</span><span class="WHIT">
<span id='line221' class='line'> 221</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alreadyExistsFile</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line222' class='line'> 222</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">alreadyExistsFile</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.deleteFile</span><span class="PUNC">(</span><span class="NAME">alreadyExistsFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line223' class='line'> 223</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line224' class='line'> 224</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.Node.createNode</span><span class="PUNC">(</span><span class="STRN">'file'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aAttrs</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">createdate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line225' class='line'> 225</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">parent.appendChild</span><span class="PUNC">(</span><span class="NAME">file</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line226' class='line'> 226</span> 
<span id='line227' class='line'> 227</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//更新を通知</span><span class="WHIT">
<span id='line228' class='line'> 228</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line229' class='line'> 229</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line230' class='line'> 230</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">file</span><span class="PUNC">;</span><span class="WHIT">
<span id='line231' class='line'> 231</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line232' class='line'> 232</span> 
<span id='line233' class='line'> 233</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line234' class='line'> 234</span> &nbsp;&nbsp;&nbsp;&nbsp; * フォルダを作成する&lt;br>
<span id='line235' class='line'> 235</span> &nbsp;&nbsp;&nbsp;&nbsp; * 指定したフォルダが存在しない場合は自動で作成する
<span id='line236' class='line'> 236</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line237' class='line'> 237</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath 作成するフォルダのパス
<span id='line238' class='line'> 238</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Node} 作成したフォルダのノード
<span id='line239' class='line'> 239</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line240' class='line'> 240</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">createFolder</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line241' class='line'> 241</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//すでにフォルダが存在している場合は上書きする</span><span class="WHIT">
<span id='line242' class='line'> 242</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alreadyExistsFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line243' class='line'> 243</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">alreadyExistsFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.deleteFile</span><span class="PUNC">(</span><span class="NAME">alreadyExistsFolder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line244' class='line'> 244</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line245' class='line'> 245</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFolderTreeFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line246' class='line'> 246</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line247' class='line'> 247</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//存在する最も深いフォルダを調べる</span><span class="WHIT">
<span id='line248' class='line'> 248</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deepestIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span id='line249' class='line'> 249</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">folderTree.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aFolder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aArray</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line250' class='line'> 250</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">joFileManager.exist</span><span class="PUNC">(</span><span class="NAME">aFolder</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">deepestIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aIndex</span><span class="PUNC">;</span><span class="WHIT">
<span id='line251' class='line'> 251</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line252' class='line'> 252</span> 
<span id='line253' class='line'> 253</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">folderTree</span><span class="PUNC">[</span><span class="NAME">deepestIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line254' class='line'> 254</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_parentPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folderTree</span><span class="PUNC">[</span><span class="NAME">deepestIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line255' class='line'> 255</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderName</span><span class="PUNC">;</span><span class="WHIT">
<span id='line256' class='line'> 256</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line257' class='line'> 257</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//存在しないフォルダをすべて作成</span><span class="WHIT">
<span id='line258' class='line'> 258</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">deepestIndex</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line259' class='line'> 259</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line260' class='line'> 260</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">folderName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFolderNameFromPath</span><span class="PUNC">(</span><span class="NAME">folderTree</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line261' class='line'> 261</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.logger.log</span><span class="PUNC">(</span><span class="STRN">'Create Folder:'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">folderName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line262' class='line'> 262</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line263' class='line'> 263</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.Node.createNode</span><span class="PUNC">(</span><span class="STRN">'folder'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">folderName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">createdate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line264' class='line'> 264</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">parent.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line265' class='line'> 265</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="WHIT">
<span id='line266' class='line'> 266</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line267' class='line'> 267</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line268' class='line'> 268</span> 
<span id='line269' class='line'> 269</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">_parentPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line270' class='line'> 270</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line271' class='line'> 271</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">;</span><span class="WHIT">
<span id='line272' class='line'> 272</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line273' class='line'> 273</span> 
<span id='line274' class='line'> 274</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line275' class='line'> 275</span> &nbsp;&nbsp;&nbsp;&nbsp; * フォルダ/ファイルが存在するかどうか調べる
<span id='line276' class='line'> 276</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line277' class='line'> 277</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath パス
<span id='line278' class='line'> 278</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Boolean}
<span id='line279' class='line'> 279</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line280' class='line'> 280</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">exist</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line281' class='line'> 281</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line282' class='line'> 282</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line283' class='line'> 283</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line284' class='line'> 284</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line285' class='line'> 285</span> &nbsp;&nbsp;&nbsp;&nbsp; * あるフォルダが指定したファイルを含んでいるかどうか調べる
<span id='line286' class='line'> 286</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line287' class='line'> 287</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aContainer 調べるフォルダ
<span id='line288' class='line'> 288</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath 調べるファイル
<span id='line289' class='line'> 289</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {Boolean} [isRecursive=false] 子フォルダも対象にするかどうか
<span id='line290' class='line'> 290</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Boolean}
<span id='line291' class='line'> 291</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line292' class='line'> 292</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">isContain</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aContainer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isRecursive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line293' class='line'> 293</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isRecursive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line294' class='line'> 294</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aPath.indexOf</span><span class="PUNC">(</span><span class="NAME">aContainer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span id='line295' class='line'> 295</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span id='line296' class='line'> 296</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">aContainer</span><span class="PUNC">;</span><span class="WHIT">
<span id='line297' class='line'> 297</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line298' class='line'> 298</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line299' class='line'> 299</span> 
<span id='line300' class='line'> 300</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line301' class='line'> 301</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルに書き込む
<span id='line302' class='line'> 302</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line303' class='line'> 303</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String} aData 書き込むデータ
<span id='line304' class='line'> 304</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath 書き込み先のファイルのパス
<span id='line305' class='line'> 305</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Node} 書き込んだファイルのノード
<span id='line306' class='line'> 306</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line307' class='line'> 307</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">write</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aData</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line308' class='line'> 308</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line309' class='line'> 309</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line310' class='line'> 310</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">file.childNodes.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line311' class='line'> 311</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.Node.remove</span><span class="PUNC">(</span><span class="NAME">file.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line312' class='line'> 312</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line313' class='line'> 313</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line314' class='line'> 314</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">file.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">aData</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line315' class='line'> 315</span> 
<span id='line316' class='line'> 316</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line317' class='line'> 317</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line318' class='line'> 318</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">file</span><span class="PUNC">;</span><span class="WHIT">
<span id='line319' class='line'> 319</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line320' class='line'> 320</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line321' class='line'> 321</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line322' class='line'> 322</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルを移動する
<span id='line323' class='line'> 323</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line324' class='line'> 324</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath 移動するファイルのパス
<span id='line325' class='line'> 325</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} moveTo 移動先のフォルダのパス
<span id='line326' class='line'> 326</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Boolean} 移動に成功したかどうか
<span id='line327' class='line'> 327</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line328' class='line'> 328</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">move</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">moveTo</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line329' class='line'> 329</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line330' class='line'> 330</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line331' class='line'> 331</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fileName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFileNameFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getFolderNameFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line332' class='line'> 332</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line333' class='line'> 333</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">moveToFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">moveTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line334' class='line'> 334</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line335' class='line'> 335</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.logger.log</span><span class="PUNC">(</span><span class="STRN">'Move file from '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">' to '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">moveTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line336' class='line'> 336</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line337' class='line'> 337</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//同名ファイルが移動先に存在していた時は失敗させる</span><span class="WHIT">
<span id='line338' class='line'> 338</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ただし、移動先のフォルダが元あったフォルダと同じ場合は、単にフォルダ内でクリック/移動しただけなので問題ない</span><span class="WHIT">
<span id='line339' class='line'> 339</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">moveTo</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.exist</span><span class="PUNC">(</span><span class="NAME">moveTo</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line340' class='line'> 340</span> 
<span id='line341' class='line'> 341</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line342' class='line'> 342</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line343' class='line'> 343</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line344' class='line'> 344</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line345' class='line'> 345</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joCore.Node.moveNode</span><span class="PUNC">(</span><span class="NAME">file</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">moveToFolder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line346' class='line'> 346</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line347' class='line'> 347</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//単にフォルダ内で移動しただけ以外のときは更新を通知する</span><span class="WHIT">
<span id='line348' class='line'> 348</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">moveTo</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line349' class='line'> 349</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line350' class='line'> 350</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">moveTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line351' class='line'> 351</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line352' class='line'> 352</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line353' class='line'> 353</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span id='line354' class='line'> 354</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line355' class='line'> 355</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line356' class='line'> 356</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line357' class='line'> 357</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルをリネームする
<span id='line358' class='line'> 358</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line359' class='line'> 359</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath リネームするファイル
<span id='line360' class='line'> 360</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String} newName リネーム後の名前
<span id='line361' class='line'> 361</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {Boolean} リネームに成功したかどうか
<span id='line362' class='line'> 362</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line363' class='line'> 363</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">rename</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line364' class='line'> 364</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line365' class='line'> 365</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line366' class='line'> 366</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line367' class='line'> 367</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//すでに同名のファイルが存在した場合は失敗させる</span><span class="WHIT">
<span id='line368' class='line'> 368</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.exist</span><span class="PUNC">(</span><span class="NAME">aPath.replace</span><span class="PUNC">(</span><span class="REGX">/[^\/]+\/?$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line369' class='line'> 369</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line370' class='line'> 370</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line371' class='line'> 371</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line372' class='line'> 372</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">file.setAttribute</span><span class="PUNC">(</span><span class="STRN">'name'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line373' class='line'> 373</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line374' class='line'> 374</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span id='line375' class='line'> 375</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line376' class='line'> 376</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line377' class='line'> 377</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line378' class='line'> 378</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルを削除する
<span id='line379' class='line'> 379</span> &nbsp;&nbsp;&nbsp;&nbsp; *
<span id='line380' class='line'> 380</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} aPath 削除するファイル
<span id='line381' class='line'> 381</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Boolean} 削除に成功したかどうか
<span id='line382' class='line'> 382</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line383' class='line'> 383</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">deleteFile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line384' class='line'> 384</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFile</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line385' class='line'> 385</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">file</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line386' class='line'> 386</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line387' class='line'> 387</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span id='line388' class='line'> 388</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">file.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">file</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line389' class='line'> 389</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.onChangeTree</span><span class="PUNC">(</span><span class="NAME">this.getParentFolderFromPath</span><span class="PUNC">(</span><span class="NAME">aPath</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line390' class='line'> 390</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span id='line391' class='line'> 391</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line392' class='line'> 392</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line393' class='line'> 393</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line394' class='line'> 394</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line395' class='line'> 395</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line396' class='line'> 396</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_defaultProgram</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span id='line397' class='line'> 397</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'html'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'dinos.texteditor'</span><span class="PUNC">,</span><span class="WHIT">
<span id='line398' class='line'> 398</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'txt'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'dinos.texteditor'</span><span class="PUNC">,</span><span class="WHIT">
<span id='line399' class='line'> 399</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'json'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'dinos.texteditor'</span><span class="PUNC">,</span><span class="WHIT">
<span id='line400' class='line'> 400</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'css'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'dinos.texteditor'</span><span class="PUNC">,</span><span class="WHIT">
<span id='line401' class='line'> 401</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'png'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'dinos.imageviewer'</span><span class="PUNC">,</span><span class="WHIT">
<span id='line402' class='line'> 402</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line403' class='line'> 403</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line404' class='line'> 404</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line405' class='line'> 405</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルの種類に応じたデフォルトプログラムを返す
<span id='line406' class='line'> 406</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String} aFileName ファイル名
<span id='line407' class='line'> 407</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line408' class='line'> 408</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">getDefaultProgram</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aFileName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line409' class='line'> 409</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filename</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aFileName.replace</span><span class="PUNC">(</span><span class="REGX">/(.*)\.[^.]+$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line410' class='line'> 410</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aFileName.replace</span><span class="PUNC">(</span><span class="REGX">/.*\.([^.]+)$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line411' class='line'> 411</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line412' class='line'> 412</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span id='line413' class='line'> 413</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._defaultProgram</span><span class="PUNC">[</span><span class="NAME">ext</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line414' class='line'> 414</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line415' class='line'> 415</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span id='line416' class='line'> 416</span> 
<span id='line417' class='line'> 417</span> 
<span id='line418' class='line'> 418</span> </span><span class="doccmt">/**
<span id='line419' class='line'> 419</span>  * File Picker &lt;br>
<span id='line420' class='line'> 420</span>  * インスタンスを作成したあとshow()を呼ぶと表示される
<span id='line421' class='line'> 421</span>  * <span class="doctag">@constructor</span>
<span id='line422' class='line'> 422</span>  * <span class="doctag">@param</span> {Object} option
<span id='line423' class='line'> 423</span>  * <span class="doctag">@param</span> {String} .mode "Save" or "Open"
<span id='line424' class='line'> 424</span>  * <span class="doctag">@param</span> {String} .application アプリケーションID
<span id='line425' class='line'> 425</span>  * <span class="doctag">@param</span> {Boolean} [.multiple] 複数選択できるようにするか（Openモードのときのみ有効）
<span id='line426' class='line'> 426</span>  * <span class="doctag">@example</span>
<span id='line427' class='line'> 427</span>  *    var fp = new joFilePicker({ mode: 'Save', application: 'dinos.finder' });
<span id='line428' class='line'> 428</span>  *    fp.show();
<span id='line429' class='line'> 429</span>  */</span><span class="WHIT">
<span id='line430' class='line'> 430</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">joFilePicker</span><span class="PUNC">(</span><span class="NAME">option</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line431' class='line'> 431</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.option</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">option</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span id='line432' class='line'> 432</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line433' class='line'> 433</span> </span><span class="PUNC">}</span><span class="WHIT">
<span id='line434' class='line'> 434</span> 
<span id='line435' class='line'> 435</span> </span><span class="NAME">joFilePicker.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span id='line436' class='line'> 436</span> 
<span id='line437' class='line'> 437</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line438' class='line'> 438</span> &nbsp;&nbsp;&nbsp;&nbsp; * 初期化処理
<span id='line439' class='line'> 439</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@private</span>
<span id='line440' class='line'> 440</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line441' class='line'> 441</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line442' class='line'> 442</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line443' class='line'> 443</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line444' class='line'> 444</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line445' class='line'> 445</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line446' class='line'> 446</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルピッカーを表示する
<span id='line447' class='line'> 447</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Deferred|(String|Array)} 選択されたファイルのパス（multipleが有効な時はパスの配列）
<span id='line448' class='line'> 448</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line449' class='line'> 449</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">show</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line450' class='line'> 450</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.deferred</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Deferred</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line451' class='line'> 451</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line452' class='line'> 452</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joUI.window</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span id='line453' class='line'> 453</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT">
<span id='line454' class='line'> 454</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">350</span><span class="PUNC">,</span><span class="WHIT">
<span id='line455' class='line'> 455</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">application</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.option.application</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'dinos.finder'</span><span class="PUNC">,</span><span class="WHIT">
<span id='line456' class='line'> 456</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line457' class='line'> 457</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line458' class='line'> 458</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">'_build'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.option.mode</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line459' class='line'> 459</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line460' class='line'> 460</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.deferred</span><span class="PUNC">;</span><span class="WHIT">
<span id='line461' class='line'> 461</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line462' class='line'> 462</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line463' class='line'> 463</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line464' class='line'> 464</span> &nbsp;&nbsp;&nbsp;&nbsp; * ファイルピッカーを閉じる
<span id='line465' class='line'> 465</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line466' class='line'> 466</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">close</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line467' class='line'> 467</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line468' class='line'> 468</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line469' class='line'> 469</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line470' class='line'> 470</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line471' class='line'> 471</span> &nbsp;&nbsp;&nbsp;&nbsp; * キャンセルする（キャンセルボタンから呼び出される）
<span id='line472' class='line'> 472</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line473' class='line'> 473</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">cancel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line474' class='line'> 474</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line475' class='line'> 475</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.deferred.call</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line476' class='line'> 476</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line477' class='line'> 477</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line478' class='line'> 478</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line479' class='line'> 479</span> &nbsp;&nbsp;&nbsp;&nbsp; * Saveモードの画面を構築する
<span id='line480' class='line'> 480</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line481' class='line'> 481</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_buildSave</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line482' class='line'> 482</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.setTitle</span><span class="PUNC">(</span><span class="STRN">'Save As'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line483' class='line'> 483</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line484' class='line'> 484</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ファイル名入力欄</span><span class="WHIT">
<span id='line485' class='line'> 485</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.addContent</span><span class="PUNC">(</span><span class="STRN">'&lt;div class="filepicker-filename">Save As: &lt;input type="text" class="filepicker-filename-input" />&lt;/div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line486' class='line'> 486</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line487' class='line'> 487</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ファイルツリー</span><span class="WHIT">
<span id='line488' class='line'> 488</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.addContent</span><span class="PUNC">(</span><span class="STRN">'&lt;div class="filepicker-filetree">&lt;/div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line489' class='line'> 489</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line490' class='line'> 490</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ボタン</span><span class="WHIT">
<span id='line491' class='line'> 491</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.addStatusbar</span><span class="PUNC">(</span><span class="STRN">'&lt;div class="filepicker-controls">'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span id='line492' class='line'> 492</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'&lt;button class="button-ok">Save&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span id='line493' class='line'> 493</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'&lt;button class="button-cancel">Cancel&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span id='line494' class='line'> 494</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'&lt;/div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line495' class='line'> 495</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line496' class='line'> 496</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line497' class='line'> 497</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//OKボタンのイベント登録</span><span class="WHIT">
<span id='line498' class='line'> 498</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joEvent.addEvent</span><span class="PUNC">(</span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'button-ok'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.win.display.statusbar</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line499' class='line'> 499</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line500' class='line'> 500</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">saveToPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._listTree.selected</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line501' class='line'> 501</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fileName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'filepicker-filename-input'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span id='line502' class='line'> 502</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line503' class='line'> 503</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//フォルダが選択されていない or ファイル名が入力されていない時は何もしない</span><span class="WHIT">
<span id='line504' class='line'> 504</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">saveToPath.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">saveToPath.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span id='line505' class='line'> 505</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                     </span><span class="PUNC">!</span><span class="NAME">fileName</span><span class="WHIT">                           </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span id='line506' class='line'> 506</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line507' class='line'> 507</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ウィンドウを閉じる</span><span class="WHIT">
<span id='line508' class='line'> 508</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line509' class='line'> 509</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line510' class='line'> 510</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//処理を返す</span><span class="WHIT">
<span id='line511' class='line'> 511</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.deferred.call</span><span class="PUNC">(</span><span class="NAME">saveToPath</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line512' class='line'> 512</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line513' class='line'> 513</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line514' class='line'> 514</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line515' class='line'> 515</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//キャンセルボタンのイベント登録</span><span class="WHIT">
<span id='line516' class='line'> 516</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joEvent.addEvent</span><span class="PUNC">(</span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'button-cancel'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.win.display.statusbar</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.cancel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line517' class='line'> 517</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line518' class='line'> 518</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ツリーの中身を構築する</span><span class="WHIT">
<span id='line519' class='line'> 519</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fileTreeData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getFileTreeObject</span><span class="PUNC">(</span><span class="STRN">'dinos://'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line520' class='line'> 520</span> 
<span id='line521' class='line'> 521</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this._listTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joUI.listTree</span><span class="PUNC">(</span><span class="NAME">fileTreeData</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'filepicker-filetree'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.win.display.content</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line522' class='line'> 522</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line523' class='line'> 523</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line524' class='line'> 524</span> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line525' class='line'> 525</span> &nbsp;&nbsp;&nbsp;&nbsp; * Openモードの画面を構築する
<span id='line526' class='line'> 526</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line527' class='line'> 527</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_buildOpen</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line528' class='line'> 528</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.setTitle</span><span class="PUNC">(</span><span class="STRN">'Open As'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line529' class='line'> 529</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line530' class='line'> 530</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ファイルツリー</span><span class="WHIT">
<span id='line531' class='line'> 531</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.addContent</span><span class="PUNC">(</span><span class="STRN">'&lt;div class="filepicker-filetree">&lt;/div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line532' class='line'> 532</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line533' class='line'> 533</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ボタン</span><span class="WHIT">
<span id='line534' class='line'> 534</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.win.addStatusbar</span><span class="PUNC">(</span><span class="STRN">'&lt;div class="filepicker-controls">'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span id='line535' class='line'> 535</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'&lt;button class="button-ok">Open&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span id='line536' class='line'> 536</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'&lt;button class="button-cancel">Cancel&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span id='line537' class='line'> 537</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="STRN">'&lt;/div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line538' class='line'> 538</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line539' class='line'> 539</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//OKボタンのイベント登録</span><span class="WHIT">
<span id='line540' class='line'> 540</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joEvent.addEvent</span><span class="PUNC">(</span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'button-ok'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.win.display.statusbar</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line541' class='line'> 541</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line542' class='line'> 542</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">openToPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.option.multiple</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this._listTree.selected</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span id='line543' class='line'> 543</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this._listTree.selected</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line544' class='line'> 544</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line545' class='line'> 545</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//フォルダが選択されている時は何もしない</span><span class="WHIT">
<span id='line546' class='line'> 546</span> </span><span class="COMM">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(openToPath.lastIndexOf('/') === openToPath.length-1) return;</span><span class="WHIT">
<span id='line547' class='line'> 547</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line548' class='line'> 548</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ウィンドウを閉じる</span><span class="WHIT">
<span id='line549' class='line'> 549</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line550' class='line'> 550</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line551' class='line'> 551</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//処理を返す</span><span class="WHIT">
<span id='line552' class='line'> 552</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this.deferred.call</span><span class="PUNC">(</span><span class="NAME">openToPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line553' class='line'> 553</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line554' class='line'> 554</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line555' class='line'> 555</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line556' class='line'> 556</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//キャンセルボタンのイベント登録</span><span class="WHIT">
<span id='line557' class='line'> 557</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">joEvent.addEvent</span><span class="PUNC">(</span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'button-cancel'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.win.display.statusbar</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.cancel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line558' class='line'> 558</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line559' class='line'> 559</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//ツリーの中身を構築する</span><span class="WHIT">
<span id='line560' class='line'> 560</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fileTreeData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getFileTreeObject</span><span class="PUNC">(</span><span class="STRN">'dinos://'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line561' class='line'> 561</span> 
<span id='line562' class='line'> 562</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">this._listTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joUI.listTree</span><span class="PUNC">(</span><span class="NAME">fileTreeData</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$C</span><span class="PUNC">(</span><span class="STRN">'filepicker-filetree'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.win.display.content</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.option.multiple</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line563' class='line'> 563</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line564' class='line'> 564</span> 
<span id='line565' class='line'> 565</span> 
<span id='line566' class='line'> 566</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="doccmt">/**
<span id='line567' class='line'> 567</span> &nbsp;&nbsp;&nbsp;&nbsp; * ListTree用のファイルツリーオブジェクトを得る
<span id='line568' class='line'> 568</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@param</span> {String/DinosPath} [root=dinos://] 取得するツリーのルート要素
<span id='line569' class='line'> 569</span> &nbsp;&nbsp;&nbsp;&nbsp; * <span class="doctag">@return</span> {Array} 各要素は以下のようなオブジェクト &lt;br>
<span id='line570' class='line'> 570</span> &nbsp;&nbsp;&nbsp;&nbsp; *     {                                &lt;br>
<span id='line571' class='line'> 571</span> &nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;     {String} data ファイル名           &lt;br>
<span id='line572' class='line'> 572</span> &nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {String} value ファイルパス         &lt;br>
<span id='line573' class='line'> 573</span> &nbsp;&nbsp;&nbsp;&nbsp; *       {Array} [children] ファイルに子ファイルがある場合、ここに子ファイルのツリーオブジェクトが入る &lt;br>
<span id='line574' class='line'> 574</span> &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp;　　 ｝
<span id='line575' class='line'> 575</span> &nbsp;&nbsp;&nbsp;&nbsp; */</span><span class="WHIT">
<span id='line576' class='line'> 576</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">_getFileTreeObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line577' class='line'> 577</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">root</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">root</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'dinos://'</span><span class="PUNC">;</span><span class="WHIT">
<span id='line578' class='line'> 578</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line579' class='line'> 579</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joFileManager.getFile</span><span class="PUNC">(</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line580' class='line'> 580</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span id='line581' class='line'> 581</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line582' class='line'> 582</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line583' class='line'> 583</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">hasChildFiles</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line584' class='line'> 584</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">node.hasChildNodes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line585' class='line'> 585</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line586' class='line'> 586</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">node.childNodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line587' class='line'> 587</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">node.ELEMENT_NODE</span><span class="PUNC">)</span><span class="WHIT">
<span id='line588' class='line'> 588</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span id='line589' class='line'> 589</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line590' class='line'> 590</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line591' class='line'> 591</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span id='line592' class='line'> 592</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line593' class='line'> 593</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line594' class='line'> 594</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line595' class='line'> 595</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="COMM">//子要素を取得し、配列に変換し、文字コード順にソートする</span><span class="WHIT">
<span id='line596' class='line'> 596</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joCore.utils.toArray</span><span class="PUNC">(</span><span class="NAME">parent.childNodes</span><span class="PUNC">)</span><span class="WHIT">
<span id='line597' class='line'> 597</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.getAttribute</span><span class="PUNC">(</span><span class="STRN">'name'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b.getAttribute</span><span class="PUNC">(</span><span class="STRN">'name'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line598' class='line'> 598</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line599' class='line'> 599</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span id='line600' class='line'> 600</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line601' class='line'> 601</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span id='line602' class='line'> 602</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line603' class='line'> 603</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">'name'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line604' class='line'> 604</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hasChild</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hasChildFiles</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line605' class='line'> 605</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line606' class='line'> 606</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span id='line607' class='line'> 607</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">data</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT">
<span id='line608' class='line'> 608</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">root</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">hasChild</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span id='line609' class='line'> 609</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span id='line610' class='line'> 610</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line611' class='line'> 611</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">hasChild</span><span class="PUNC">)</span><span class="WHIT">
<span id='line612' class='line'> 612</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">item.children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getFileTreeObject</span><span class="PUNC">(</span><span class="NAME">root</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line613' class='line'> 613</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id='line614' class='line'> 614</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="NAME">treeObject.push</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span id='line615' class='line'> 615</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="WHIT">
<span id='line616' class='line'> 616</span> 
<span id='line617' class='line'> 617</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">treeObject</span><span class="PUNC">;</span><span class="WHIT">
<span id='line618' class='line'> 618</span> </span><span class="WHIT">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span id='line619' class='line'> 619</span> 
<span id='line620' class='line'> 620</span> </span><span class="PUNC">}</span><span class="PUNC">;</span></pre><div class='spacer'><span class='line'>&nbsp;&nbsp;&nbsp;&nbsp;</span></div></body></html>